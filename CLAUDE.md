# CheerCast 開発ルール

このドキュメントは、CheerCastプロジェクトの開発における重要なルールとガイドラインを定義します。

## 🔥 必須ルール

### 1. テスト駆動開発（TDD）
- **新機能の追加時**: 必ず先にテストを書いてから実装を行う
- **既存コードの修正時**: 修正内容をカバーするテストを追加または更新する
- **リファクタリング時**: 既存のテストが全てパスすることを確認する

### 2. テストの実行と確認
- **コミット前**: 必ず全テストを実行し、全てパスすることを確認する
- **PR作成前**: CI/CDでのテスト結果を確認する
- **テストコマンド**: `npm test` および `npm run test:coverage`

### 3. テストカバレッジ
- **最小カバレッジ**: 80%以上を維持
- **新規コード**: 90%以上のカバレッジを目標とする
- **重要なビジネスロジック**: 100%のカバレッジを必須とする

## 📋 開発フロー

### 1. 実装前
```bash
# 1. 最新のmainブランチを取得
git pull origin main

# 2. 新しいフィーチャーブランチを作成
git checkout -b feature/your-feature-name

# 3. テストを先に書く
# tests/ディレクトリに適切なテストファイルを作成
```

### 2. 実装中
```bash
# 1. テストを実行して失敗することを確認（Red）
npm test

# 2. 最小限のコードでテストをパスさせる（Green）
npm test

# 3. コードをリファクタリング（Refactor）
npm test

# 4. リントとフォーマット
npm run lint
npm run format
```

### 3. 実装後
```bash
# 1. 全テストの実行
npm test

# 2. カバレッジの確認
npm run test:coverage

# 3. 型チェック
npm run typecheck

# 4. ビルドの確認
npm run build
```

## 🧪 テストの種類と命名規則

### ユニットテスト
- **ファイル名**: `*.test.ts` または `*.spec.ts`
- **配置場所**: テスト対象と同じディレクトリ内の `__tests__` フォルダ
- **例**: `src/core/parser/__tests__/MemoParser.test.ts`

### 統合テスト
- **ファイル名**: `*.integration.test.ts`
- **配置場所**: `tests/integration/`
- **例**: `tests/integration/generate-radio.integration.test.ts`

### E2Eテスト
- **ファイル名**: `*.e2e.test.ts`
- **配置場所**: `tests/e2e/`
- **例**: `tests/e2e/cli-commands.e2e.test.ts`

## 🏗️ コーディング規約

### TypeScript
- **strict mode**: 必ず有効にする
- **型定義**: `any`の使用は禁止（やむを得ない場合はコメントで理由を明記）
- **インターフェース**: I接頭辞は使用しない
- **型のエクスポート**: 型定義は別ファイルに分離

### ファイル構成
```typescript
// 1. インポート（外部ライブラリ → 内部モジュール）
import { Command } from 'commander';
import { MemoParser } from './core/parser';

// 2. 型定義
interface RadioConfig {
  duration: number;
  style: string;
}

// 3. 定数
const DEFAULT_DURATION = 10;

// 4. メイン実装
export class RadioGenerator {
  // 実装
}

// 5. ヘルパー関数
function validateConfig(config: RadioConfig): boolean {
  // 実装
}
```

### エラーハンドリング
- **カスタムエラー**: 専用のエラークラスを定義
- **エラーメッセージ**: 日本語で分かりやすく
- **スタックトレース**: 開発環境でのみ表示

## 🚀 コミット規約

### コミットメッセージ
```
<type>(<scope>): <subject>

<body>

<footer>
```

### タイプ
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響しない変更
- `refactor`: バグ修正や機能追加を伴わないコード変更
- `test`: テストの追加や修正
- `chore`: ビルドプロセスやツールの変更

### 例
```
feat(parser): メモファイルの複数形式対応を追加

- .txt, .md, .json, .csv形式に対応
- 自動フォーマット検出機能を実装
- テストカバレッジ95%達成

Closes #123
```

## 📝 ドキュメント

### 必須ドキュメント
- **README.md**: プロジェクト概要とクイックスタート
- **API.md**: 公開APIの仕様
- **CONTRIBUTING.md**: コントリビューションガイド
- **CHANGELOG.md**: バージョンごとの変更履歴

### コード内ドキュメント
- **JSDoc**: 全ての公開関数・クラスに必須
- **インラインコメント**: 複雑なロジックには必須
- **TODO/FIXME**: 必ず担当者とチケット番号を記載

## 🔒 セキュリティ

### APIキー管理
- **環境変数**: `.env`ファイルで管理（絶対にコミットしない）
- **デフォルト値**: 本番用のキーをハードコードしない
- **権限**: 最小権限の原則を適用

### 依存関係
- **定期更新**: 月1回は依存関係を更新
- **脆弱性チェック**: `npm audit`を定期実行
- **ライセンス**: MITまたはApache 2.0互換のみ使用

## ⚡ パフォーマンス

### 測定とモニタリング
- **ベンチマーク**: 重要な処理には必須
- **メモリ使用量**: 大きなファイル処理時は必ず確認
- **非同期処理**: 可能な限り並列化

### 最適化の原則
1. まず正しく動作させる
2. 測定して問題を特定する
3. 最適化の効果を測定する

## 🤝 コラボレーション

### プルリクエスト
- **サイズ**: 500行以内を目安
- **レビュー**: 最低1名のレビューが必須
- **テスト**: 全てグリーンでなければマージ不可

### コードレビュー
- **建設的**: 問題点だけでなく改善案も提示
- **迅速**: 24時間以内にレビュー開始
- **学習**: 新しい実装パターンは共有

## 📊 CI/CD

### 自動実行項目
1. ユニットテスト
2. 統合テスト
3. リント・フォーマット
4. 型チェック
5. ビルド
6. セキュリティスキャン

### デプロイ前チェック
- [ ] 全テストがパス
- [ ] カバレッジ80%以上
- [ ] ドキュメント更新
- [ ] CHANGELOG更新
- [ ] バージョン番号更新